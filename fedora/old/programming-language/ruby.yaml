---
- name: Ruby rbenv Installer
  hosts: localhost
  gather_facts: true
  vars:
    rbenv_repo: https://github.com/rbenv/rbenv.git
    rbenv_prerequisites:
      - autoconf
      - automake
      - bison
      - gcc-c++
      - libffi-devel
      - libtool
      - libyaml-devel
      - openssl-devel
      - patch
      - readline-devel
      - sqlite-devel
      - zlib-ng-compat-devel
    ruby_extra:
      - ruby-devel
  vars_files:
    - ../vars/vars_all.yaml

  tasks:

    - name: Install rbenv prerequisite
      become: true
      ansible.builtin.dnf:
        name: "{{ item }}"
        state: present
      loop: "{{ rbenv_prerequisites }}"

    - name: Install extra ruby dependencies
      become: true
      ansible.builtin.dnf:
        name: "{{ item }}"
        state: present
      loop: "{{ ruby_extra }}"

    - name: Git clone rbenv
      ansible.builtin.git:
        repo: "{{ rbenv_repo }}"
        dest: "{{ ansible_user_path }}/rbenv"
        clone: true # noqa: latest

    - name: Git clone rbenv
      ansible.builtin.git:
        repo: https://github.com/rbenv/ruby-build.git
        dest: "{{ ansible_user_path }}/rbenv/plugins/ruby-build"
        clone: true # noqa: latest
